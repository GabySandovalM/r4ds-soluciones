<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>19 Modelos: conceptos básicos | R para Ciencia de Datos: Soluciones de los ejercicios</title>
  <meta name="description" content="Propuestas de soluciones para los ejercicios del libro R para Ciencia de Datos" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="19 Modelos: conceptos básicos | R para Ciencia de Datos: Soluciones de los ejercicios" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://es.r4ds.hadley.nz/" />
  <meta property="og:image" content="http://es.r4ds.hadley.nz/cover.png" />
  <meta property="og:description" content="Propuestas de soluciones para los ejercicios del libro R para Ciencia de Datos" />
  <meta name="github-repo" content="cienciadedatos/r4ds" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="19 Modelos: conceptos básicos | R para Ciencia de Datos: Soluciones de los ejercicios" />
  
  <meta name="twitter:description" content="Propuestas de soluciones para los ejercicios del libro R para Ciencia de Datos" />
  <meta name="twitter:image" content="http://es.r4ds.hadley.nz/cover.png" />

<meta name="author" content="Riva Quiroga" />
<meta name="author" content="Mauricio ‘Pachá’ Vargas" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model-intro.html">
<link rel="next" href="model-building.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="r4ds.min.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Soluciones R para Ciencia de Datos</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Bienvenida</a></li>
<li class="chapter" data-level="1" data-path="introduccion.html"><a href="introduccion.html"><i class="fa fa-check"></i><b>1</b> Introducción</a></li>
<li class="chapter" data-level="2" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html"><i class="fa fa-check"></i><b>2</b> Visualización de datos</a><ul>
<li class="chapter" data-level="2.1" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#paquetes-necesarios"><i class="fa fa-check"></i><b>2.1</b> Paquetes necesarios</a></li>
<li class="chapter" data-level="2.2" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#primeros-pasos"><i class="fa fa-check"></i><b>2.2</b> Primeros pasos</a><ul>
<li class="chapter" data-level="2.2.1" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#ejercicios"><i class="fa fa-check"></i><b>2.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#mapeos-esteticos"><i class="fa fa-check"></i><b>2.3</b> Mapeos estéticos</a><ul>
<li class="chapter" data-level="2.3.1" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#ejercicios-1"><i class="fa fa-check"></i><b>2.3.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#separar-en-facetas"><i class="fa fa-check"></i><b>2.4</b> Separar en facetas</a><ul>
<li class="chapter" data-level="2.4.1" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#ejercicios-2"><i class="fa fa-check"></i><b>2.4.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#objetos-geometricos"><i class="fa fa-check"></i><b>2.5</b> Objetos geométricos</a><ul>
<li class="chapter" data-level="2.5.1" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#ejercicios-3"><i class="fa fa-check"></i><b>2.5.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#transformaciones-estadisticas"><i class="fa fa-check"></i><b>2.6</b> Transformaciones estadísticas</a><ul>
<li class="chapter" data-level="2.6.1" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#ejercicios-4"><i class="fa fa-check"></i><b>2.6.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#ajustes-de-posicion"><i class="fa fa-check"></i><b>2.7</b> Ajustes de posición</a><ul>
<li class="chapter" data-level="2.7.1" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#ejercicios-5"><i class="fa fa-check"></i><b>2.7.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#sistemas-de-coordenadas"><i class="fa fa-check"></i><b>2.8</b> Sistemas de coordenadas</a><ul>
<li class="chapter" data-level="2.8.1" data-path="visualizacion-de-datos.html"><a href="visualizacion-de-datos.html#ejercicios-6"><i class="fa fa-check"></i><b>2.8.1</b> Ejercicios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="flujo-de-trabajo-conocimientos-basicos.html"><a href="flujo-de-trabajo-conocimientos-basicos.html"><i class="fa fa-check"></i><b>3</b> Flujo de trabajo: conocimientos básicos</a><ul>
<li class="chapter" data-level="3.1" data-path="flujo-de-trabajo-conocimientos-basicos.html"><a href="flujo-de-trabajo-conocimientos-basicos.html#practica"><i class="fa fa-check"></i><b>3.1</b> Práctica</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="transform.html"><a href="transform.html"><i class="fa fa-check"></i><b>4</b> Transformación de datos</a><ul>
<li class="chapter" data-level="4.1" data-path="transform.html"><a href="transform.html#introduccion-1"><i class="fa fa-check"></i><b>4.1</b> Introducción</a><ul>
<li class="chapter" data-level="4.1.1" data-path="transform.html"><a href="transform.html#ejercicios-7"><i class="fa fa-check"></i><b>4.1.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="transform.html"><a href="transform.html#reordenar-las-filas-con-arrange"><i class="fa fa-check"></i><b>4.2</b> Reordenar las filas con <code>arrange()</code></a><ul>
<li class="chapter" data-level="4.2.1" data-path="transform.html"><a href="transform.html#ejercicios-8"><i class="fa fa-check"></i><b>4.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="transform.html"><a href="transform.html#select"><i class="fa fa-check"></i><b>4.3</b> Seleccionar columnas con <code>select()</code></a><ul>
<li class="chapter" data-level="4.3.1" data-path="transform.html"><a href="transform.html#ejercicios-9"><i class="fa fa-check"></i><b>4.3.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="transform.html"><a href="transform.html#anadir-nuevas-variables-con-mutate"><i class="fa fa-check"></i><b>4.4</b> Añadir nuevas variables con <code>mutate()</code></a><ul>
<li class="chapter" data-level="4.4.1" data-path="transform.html"><a href="transform.html#ejercicios-10"><i class="fa fa-check"></i><b>4.4.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="transform.html"><a href="transform.html#resumenes-agrupados-con-summarise"><i class="fa fa-check"></i><b>4.5</b> Resúmenes agrupados con <code>summarise()</code></a><ul>
<li class="chapter" data-level="4.5.1" data-path="transform.html"><a href="transform.html#ejercicios-11"><i class="fa fa-check"></i><b>4.5.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="transform.html"><a href="transform.html#transformaciones-agrupadas-y-filtros"><i class="fa fa-check"></i><b>4.6</b> Transformaciones agrupadas (y filtros)</a><ul>
<li class="chapter" data-level="4.6.1" data-path="transform.html"><a href="transform.html#ejercicios-12"><i class="fa fa-check"></i><b>4.6.1</b> Ejercicios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="flujo-de-trabajo-scripts.html"><a href="flujo-de-trabajo-scripts.html"><i class="fa fa-check"></i><b>5</b> Flujo de trabajo: <em>Scripts</em></a><ul>
<li class="chapter" data-level="5.1" data-path="flujo-de-trabajo-scripts.html"><a href="flujo-de-trabajo-scripts.html#practica-1"><i class="fa fa-check"></i><b>5.1</b> Práctica</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>6</b> Exploratory Data Analysis</a></li>
<li class="chapter" data-level="7" data-path="workflow-projects.html"><a href="workflow-projects.html"><i class="fa fa-check"></i><b>7</b> Workflow: projects</a></li>
<li class="chapter" data-level="8" data-path="tibbles.html"><a href="tibbles.html"><i class="fa fa-check"></i><b>8</b> Tibbles</a><ul>
<li class="chapter" data-level="8.1" data-path="tibbles.html"><a href="tibbles.html#ejercicios-13"><i class="fa fa-check"></i><b>8.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="importacion-de-datos.html"><a href="importacion-de-datos.html"><i class="fa fa-check"></i><b>9</b> Importación de datos</a><ul>
<li class="chapter" data-level="9.1" data-path="importacion-de-datos.html"><a href="importacion-de-datos.html#introduccion-2"><i class="fa fa-check"></i><b>9.1</b> Introducción</a><ul>
<li class="chapter" data-level="9.1.1" data-path="importacion-de-datos.html"><a href="importacion-de-datos.html#prerrequisitos"><i class="fa fa-check"></i><b>9.1.1</b> Prerrequisitos</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="importacion-de-datos.html"><a href="importacion-de-datos.html#comenzando"><i class="fa fa-check"></i><b>9.2</b> Comenzando</a><ul>
<li class="chapter" data-level="9.2.1" data-path="importacion-de-datos.html"><a href="importacion-de-datos.html#ejercicios-14"><i class="fa fa-check"></i><b>9.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="importacion-de-datos.html"><a href="importacion-de-datos.html#analizando-un-vector"><i class="fa fa-check"></i><b>9.3</b> Analizando un vector</a><ul>
<li class="chapter" data-level="9.3.1" data-path="importacion-de-datos.html"><a href="importacion-de-datos.html#ejercicios-15"><i class="fa fa-check"></i><b>9.3.1</b> Ejercicios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="datos-ordenados.html"><a href="datos-ordenados.html"><i class="fa fa-check"></i><b>10</b> Datos ordenados</a><ul>
<li class="chapter" data-level="10.1" data-path="datos-ordenados.html"><a href="datos-ordenados.html#datos-ordenados-1"><i class="fa fa-check"></i><b>10.1</b> Datos ordenados</a><ul>
<li class="chapter" data-level="10.1.1" data-path="datos-ordenados.html"><a href="datos-ordenados.html#ejercicios-16"><i class="fa fa-check"></i><b>10.1.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="datos-ordenados.html"><a href="datos-ordenados.html#reunir-y-esparcir"><i class="fa fa-check"></i><b>10.2</b> Reunir y Esparcir</a><ul>
<li class="chapter" data-level="10.2.1" data-path="datos-ordenados.html"><a href="datos-ordenados.html#ejercicios-17"><i class="fa fa-check"></i><b>10.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="datos-ordenados.html"><a href="datos-ordenados.html#separar-y-unir"><i class="fa fa-check"></i><b>10.3</b> Separar y unir</a><ul>
<li class="chapter" data-level="10.3.1" data-path="datos-ordenados.html"><a href="datos-ordenados.html#ejercicios-18"><i class="fa fa-check"></i><b>10.3.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="datos-ordenados.html"><a href="datos-ordenados.html#valores-faltantes"><i class="fa fa-check"></i><b>10.4</b> Valores faltantes</a><ul>
<li class="chapter" data-level="10.4.1" data-path="datos-ordenados.html"><a href="datos-ordenados.html#ejercicios-19"><i class="fa fa-check"></i><b>10.4.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="datos-ordenados.html"><a href="datos-ordenados.html#estudio-de-caso"><i class="fa fa-check"></i><b>10.5</b> Estudio de caso</a><ul>
<li class="chapter" data-level="10.5.1" data-path="datos-ordenados.html"><a href="datos-ordenados.html#ejercicios-20"><i class="fa fa-check"></i><b>10.5.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="datos-ordenados.html"><a href="datos-ordenados.html#datos-no-ordenados"><i class="fa fa-check"></i><b>10.6</b> Datos no ordenados</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="datos-relacionales.html"><a href="datos-relacionales.html"><i class="fa fa-check"></i><b>11</b> Datos relacionales</a><ul>
<li class="chapter" data-level="11.1" data-path="datos-relacionales.html"><a href="datos-relacionales.html#paquetes-necesarios-1"><i class="fa fa-check"></i><b>11.1</b> Paquetes necesarios</a></li>
<li class="chapter" data-level="11.2" data-path="datos-relacionales.html"><a href="datos-relacionales.html#nycflights13-relational"><i class="fa fa-check"></i><b>11.2</b> datos</a><ul>
<li class="chapter" data-level="11.2.1" data-path="datos-relacionales.html"><a href="datos-relacionales.html#ejercicios-21"><i class="fa fa-check"></i><b>11.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="datos-relacionales.html"><a href="datos-relacionales.html#llaves"><i class="fa fa-check"></i><b>11.3</b> Llaves</a><ul>
<li class="chapter" data-level="11.3.1" data-path="datos-relacionales.html"><a href="datos-relacionales.html#ejercicios-22"><i class="fa fa-check"></i><b>11.3.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="datos-relacionales.html"><a href="datos-relacionales.html#mutating-joins"><i class="fa fa-check"></i><b>11.4</b> Uniones de transformación</a><ul>
<li class="chapter" data-level="11.4.1" data-path="datos-relacionales.html"><a href="datos-relacionales.html#ejercicios-23"><i class="fa fa-check"></i><b>11.4.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="datos-relacionales.html"><a href="datos-relacionales.html#filtering-joins"><i class="fa fa-check"></i><b>11.5</b> Uniones de filtro</a><ul>
<li class="chapter" data-level="11.5.1" data-path="datos-relacionales.html"><a href="datos-relacionales.html#ejercicios-24"><i class="fa fa-check"></i><b>11.5.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="datos-relacionales.html"><a href="datos-relacionales.html#problemas-de-las-uniones"><i class="fa fa-check"></i><b>11.6</b> Problemas de las uniones</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html"><i class="fa fa-check"></i><b>12</b> Cadenas de caracteres</a><ul>
<li class="chapter" data-level="12.1" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#cadenas-elementos-basicos"><i class="fa fa-check"></i><b>12.1</b> Cadenas: elementos básicos</a><ul>
<li class="chapter" data-level="12.1.1" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#ejercicios-25"><i class="fa fa-check"></i><b>12.1.1</b> Ejercicios</a></li>
<li class="chapter" data-level="12.1.2" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#buscar-coincidencia-de-patrones-con-expresiones-regulares"><i class="fa fa-check"></i><b>12.1.2</b> Buscar coincidencia de patrones con expresiones regulares</a></li>
<li class="chapter" data-level="12.1.3" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#anclas"><i class="fa fa-check"></i><b>12.1.3</b> Anclas</a></li>
<li class="chapter" data-level="12.1.4" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#clases-de-caracteres-y-alternativas"><i class="fa fa-check"></i><b>12.1.4</b> Clases de caracteres y alternativas</a></li>
<li class="chapter" data-level="12.1.5" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#repeticion"><i class="fa fa-check"></i><b>12.1.5</b> Repetición</a></li>
<li class="chapter" data-level="12.1.6" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#agrupamiento-y-referencias-previas"><i class="fa fa-check"></i><b>12.1.6</b> Agrupamiento y referencias previas</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#herramientas"><i class="fa fa-check"></i><b>12.2</b> Herramientas</a><ul>
<li class="chapter" data-level="12.2.1" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#ejercicios-31"><i class="fa fa-check"></i><b>12.2.1</b> Ejercicios</a></li>
<li class="chapter" data-level="12.2.2" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#extraer-coincidencias"><i class="fa fa-check"></i><b>12.2.2</b> Extraer coincidencias</a></li>
<li class="chapter" data-level="12.2.3" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#coincidencias-agrupadas"><i class="fa fa-check"></i><b>12.2.3</b> Coincidencias agrupadas</a></li>
<li class="chapter" data-level="12.2.4" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#remplazar-coincidencias"><i class="fa fa-check"></i><b>12.2.4</b> Remplazar coincidencias</a></li>
<li class="chapter" data-level="12.2.5" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#divisiones"><i class="fa fa-check"></i><b>12.2.5</b> Divisiones</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#otro-tipo-de-patrones"><i class="fa fa-check"></i><b>12.3</b> Otro tipo de patrones</a><ul>
<li class="chapter" data-level="12.3.1" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#ejercicios-36"><i class="fa fa-check"></i><b>12.3.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#stringi"><i class="fa fa-check"></i><b>12.4</b> stringi</a><ul>
<li class="chapter" data-level="12.4.1" data-path="cadenas-de-caracteres.html"><a href="cadenas-de-caracteres.html#ejercicios-37"><i class="fa fa-check"></i><b>12.4.1</b> Ejercicios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="factores.html"><a href="factores.html"><i class="fa fa-check"></i><b>13</b> Factores</a><ul>
<li class="chapter" data-level="13.1" data-path="factores.html"><a href="factores.html#encuesta-social-general"><i class="fa fa-check"></i><b>13.1</b> Encuesta social general</a><ul>
<li class="chapter" data-level="13.1.1" data-path="factores.html"><a href="factores.html#ejercicios-38"><i class="fa fa-check"></i><b>13.1.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="factores.html"><a href="factores.html#modificar-el-orden-de-los-factores"><i class="fa fa-check"></i><b>13.2</b> Modificar el orden de los factores</a><ul>
<li class="chapter" data-level="13.2.1" data-path="factores.html"><a href="factores.html#ejercicios-39"><i class="fa fa-check"></i><b>13.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="factores.html"><a href="factores.html#modificar-los-niveles-de-los-factores"><i class="fa fa-check"></i><b>13.3</b> Modificar los niveles de los factores</a><ul>
<li class="chapter" data-level="13.3.1" data-path="factores.html"><a href="factores.html#ejercicios-40"><i class="fa fa-check"></i><b>13.3.1</b> Ejercicios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="horas-y-fechas.html"><a href="horas-y-fechas.html"><i class="fa fa-check"></i><b>14</b> Horas y fechas</a><ul>
<li class="chapter" data-level="14.1" data-path="horas-y-fechas.html"><a href="horas-y-fechas.html#creando-horasfechas"><i class="fa fa-check"></i><b>14.1</b> Creando horas/fechas</a><ul>
<li class="chapter" data-level="14.1.1" data-path="horas-y-fechas.html"><a href="horas-y-fechas.html#ejercicios-41"><i class="fa fa-check"></i><b>14.1.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="horas-y-fechas.html"><a href="horas-y-fechas.html#componentes-fecha-hora"><i class="fa fa-check"></i><b>14.2</b> Componentes fecha-hora</a><ul>
<li class="chapter" data-level="14.2.1" data-path="horas-y-fechas.html"><a href="horas-y-fechas.html#ejercicios-42"><i class="fa fa-check"></i><b>14.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="horas-y-fechas.html"><a href="horas-y-fechas.html#plazos-de-tiempo"><i class="fa fa-check"></i><b>14.3</b> Plazos de tiempo</a><ul>
<li class="chapter" data-level="14.3.1" data-path="horas-y-fechas.html"><a href="horas-y-fechas.html#ejercicios-43"><i class="fa fa-check"></i><b>14.3.1</b> Ejercicios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="funciones.html"><a href="funciones.html"><i class="fa fa-check"></i><b>15</b> Funciones</a><ul>
<li class="chapter" data-level="15.1" data-path="funciones.html"><a href="funciones.html#cuando-deberias-escribir-una-funcion"><i class="fa fa-check"></i><b>15.1</b> ¿Cuándo deberías escribir una función?</a><ul>
<li class="chapter" data-level="15.1.1" data-path="funciones.html"><a href="funciones.html#practica-2"><i class="fa fa-check"></i><b>15.1.1</b> Práctica</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="funciones.html"><a href="funciones.html#las-funciones-son-para-los-humanos-y-las-computadoras"><i class="fa fa-check"></i><b>15.2</b> Las funciones son para los humanos y las computadoras</a><ul>
<li class="chapter" data-level="15.2.1" data-path="funciones.html"><a href="funciones.html#ejercicios-44"><i class="fa fa-check"></i><b>15.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="funciones.html"><a href="funciones.html#ejecucion-condicional"><i class="fa fa-check"></i><b>15.3</b> Ejecución condicional</a><ul>
<li class="chapter" data-level="15.3.1" data-path="funciones.html"><a href="funciones.html#ejercicios-45"><i class="fa fa-check"></i><b>15.3.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="funciones.html"><a href="funciones.html#function-arguments"><i class="fa fa-check"></i><b>15.4</b> Function arguments</a><ul>
<li class="chapter" data-level="15.4.1" data-path="funciones.html"><a href="funciones.html#ejercicios-46"><i class="fa fa-check"></i><b>15.4.1</b> Ejercicios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="vectores.html"><a href="vectores.html"><i class="fa fa-check"></i><b>16</b> Vectores</a><ul>
<li class="chapter" data-level="16.1" data-path="vectores.html"><a href="vectores.html#tipos-importantes-de-vectores-atomicos"><i class="fa fa-check"></i><b>16.1</b> Tipos importantes de vectores atómicos</a></li>
<li class="chapter" data-level="16.2" data-path="vectores.html"><a href="vectores.html#usando-vectores-atomicos"><i class="fa fa-check"></i><b>16.2</b> Usando vectores atómicos</a><ul>
<li class="chapter" data-level="16.2.1" data-path="vectores.html"><a href="vectores.html#ejercicios-47"><i class="fa fa-check"></i><b>16.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="vectores.html"><a href="vectores.html#vectores-recursivos-listas"><i class="fa fa-check"></i><b>16.3</b> Vectores Recursivos (listas)</a><ul>
<li class="chapter" data-level="16.3.1" data-path="vectores.html"><a href="vectores.html#ejercicios-48"><i class="fa fa-check"></i><b>16.3.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="vectores.html"><a href="vectores.html#vectores-aumentados"><i class="fa fa-check"></i><b>16.4</b> Vectores Aumentados</a><ul>
<li class="chapter" data-level="16.4.1" data-path="vectores.html"><a href="vectores.html#ejecicios"><i class="fa fa-check"></i><b>16.4.1</b> Ejecicios:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="iteracion.html"><a href="iteracion.html"><i class="fa fa-check"></i><b>17</b> Iteración</a><ul>
<li class="chapter" data-level="17.1" data-path="iteracion.html"><a href="iteracion.html#bucles-for"><i class="fa fa-check"></i><b>17.1</b> Bucles <em>for</em></a><ul>
<li class="chapter" data-level="17.1.1" data-path="iteracion.html"><a href="iteracion.html#ejercicios-49"><i class="fa fa-check"></i><b>17.1.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="iteracion.html"><a href="iteracion.html#variaciones-de-bucles-for"><i class="fa fa-check"></i><b>17.2</b> Variaciones de bucles <em>for</em></a><ul>
<li class="chapter" data-level="17.2.1" data-path="iteracion.html"><a href="iteracion.html#ejercicios-50"><i class="fa fa-check"></i><b>17.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="iteracion.html"><a href="iteracion.html#bucles-for-vs.funcionales"><i class="fa fa-check"></i><b>17.3</b> Bucles <em>for</em> vs. funcionales</a><ul>
<li class="chapter" data-level="17.3.1" data-path="iteracion.html"><a href="iteracion.html#ejercicios-51"><i class="fa fa-check"></i><b>17.3.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="iteracion.html"><a href="iteracion.html#las-funciones-map-mapa-en-ingles"><i class="fa fa-check"></i><b>17.4</b> Las funciones <em>map</em> (mapa en inglés)</a><ul>
<li class="chapter" data-level="17.4.1" data-path="iteracion.html"><a href="iteracion.html#ejercicios-52"><i class="fa fa-check"></i><b>17.4.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="iteracion.html"><a href="iteracion.html#otros-patrones-para-los-loops-for"><i class="fa fa-check"></i><b>17.5</b> Otros patrones para los loops for</a><ul>
<li class="chapter" data-level="17.5.1" data-path="iteracion.html"><a href="iteracion.html#ejercicios-53"><i class="fa fa-check"></i><b>17.5.1</b> Ejercicios</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Modelar</b></span></li>
<li class="chapter" data-level="18" data-path="model-intro.html"><a href="model-intro.html"><i class="fa fa-check"></i><b>18</b> Introducción</a></li>
<li class="chapter" data-level="19" data-path="modelos-conceptos-basicos.html"><a href="modelos-conceptos-basicos.html"><i class="fa fa-check"></i><b>19</b> Modelos: conceptos básicos</a><ul>
<li class="chapter" data-level="19.1" data-path="modelos-conceptos-basicos.html"><a href="modelos-conceptos-basicos.html#paquetes-necesarios-2"><i class="fa fa-check"></i><b>19.1</b> Paquetes necesarios</a></li>
<li class="chapter" data-level="19.2" data-path="modelos-conceptos-basicos.html"><a href="modelos-conceptos-basicos.html#un-modelo-simple"><i class="fa fa-check"></i><b>19.2</b> Un modelo simple</a><ul>
<li class="chapter" data-level="19.2.1" data-path="modelos-conceptos-basicos.html"><a href="modelos-conceptos-basicos.html#ejercicios-54"><i class="fa fa-check"></i><b>19.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="modelos-conceptos-basicos.html"><a href="modelos-conceptos-basicos.html#visualizando-modelos"><i class="fa fa-check"></i><b>19.3</b> Visualizando modelos</a><ul>
<li class="chapter" data-level="19.3.1" data-path="modelos-conceptos-basicos.html"><a href="modelos-conceptos-basicos.html#ejercicios-55"><i class="fa fa-check"></i><b>19.3.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="modelos-conceptos-basicos.html"><a href="modelos-conceptos-basicos.html#formulas-y-familias-de-modelos"><i class="fa fa-check"></i><b>19.4</b> Fórmulas y familias de modelos</a><ul>
<li class="chapter" data-level="19.4.1" data-path="modelos-conceptos-basicos.html"><a href="modelos-conceptos-basicos.html#ejercicios-56"><i class="fa fa-check"></i><b>19.4.1</b> Ejercicios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="model-building.html"><a href="model-building.html"><i class="fa fa-check"></i><b>20</b> Model building</a></li>
<li class="chapter" data-level="21" data-path="muchos-modelos.html"><a href="muchos-modelos.html"><i class="fa fa-check"></i><b>21</b> Muchos modelos</a><ul>
<li class="chapter" data-level="21.1" data-path="muchos-modelos.html"><a href="muchos-modelos.html#paquetes-necesarios-3"><i class="fa fa-check"></i><b>21.1</b> Paquetes necesarios</a></li>
<li class="chapter" data-level="21.2" data-path="muchos-modelos.html"><a href="muchos-modelos.html#gapminder"><i class="fa fa-check"></i><b>21.2</b> gapminder</a><ul>
<li class="chapter" data-level="21.2.1" data-path="muchos-modelos.html"><a href="muchos-modelos.html#ejercicios-57"><i class="fa fa-check"></i><b>21.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="muchos-modelos.html"><a href="muchos-modelos.html#creando-columnas-lista"><i class="fa fa-check"></i><b>21.3</b> Creando columnas-lista</a><ul>
<li class="chapter" data-level="21.3.1" data-path="muchos-modelos.html"><a href="muchos-modelos.html#ejercicios-58"><i class="fa fa-check"></i><b>21.3.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="muchos-modelos.html"><a href="muchos-modelos.html#simplificando-columnas-lista"><i class="fa fa-check"></i><b>21.4</b> Simplificando columnas-lista</a><ul>
<li class="chapter" data-level="21.4.1" data-path="muchos-modelos.html"><a href="muchos-modelos.html#ejercicios-59"><i class="fa fa-check"></i><b>21.4.1</b> Ejercicios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>22</b> R Markdown</a><ul>
<li class="chapter" data-level="22.1" data-path="r-markdown.html"><a href="r-markdown.html#r-markdown-basico"><i class="fa fa-check"></i><b>22.1</b> R Markdown básico</a><ul>
<li class="chapter" data-level="22.1.1" data-path="r-markdown.html"><a href="r-markdown.html#ejercicios-60"><i class="fa fa-check"></i><b>22.1.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="r-markdown.html"><a href="r-markdown.html#formateo-de-texto-con-markdown"><i class="fa fa-check"></i><b>22.2</b> Formateo de texto con Markdown</a><ul>
<li class="chapter" data-level="22.2.1" data-path="r-markdown.html"><a href="r-markdown.html#ejercicios-61"><i class="fa fa-check"></i><b>22.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="r-markdown.html"><a href="r-markdown.html#bloques-de-codigo"><i class="fa fa-check"></i><b>22.3</b> Bloques de código</a><ul>
<li class="chapter" data-level="22.3.1" data-path="r-markdown.html"><a href="r-markdown.html#ejercicios-62"><i class="fa fa-check"></i><b>22.3.1</b> Ejercicios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="comunicar-con-graficos.html"><a href="comunicar-con-graficos.html"><i class="fa fa-check"></i><b>23</b> Comunicar con gráficos</a><ul>
<li class="chapter" data-level="23.1" data-path="comunicar-con-graficos.html"><a href="comunicar-con-graficos.html#paquetes-necesarios-4"><i class="fa fa-check"></i><b>23.1</b> Paquetes necesarios</a></li>
<li class="chapter" data-level="23.2" data-path="comunicar-con-graficos.html"><a href="comunicar-con-graficos.html#etiquetas"><i class="fa fa-check"></i><b>23.2</b> Etiquetas</a><ul>
<li class="chapter" data-level="23.2.1" data-path="comunicar-con-graficos.html"><a href="comunicar-con-graficos.html#ejercicios-63"><i class="fa fa-check"></i><b>23.2.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="comunicar-con-graficos.html"><a href="comunicar-con-graficos.html#anotaciones"><i class="fa fa-check"></i><b>23.3</b> Anotaciones</a><ul>
<li class="chapter" data-level="23.3.1" data-path="comunicar-con-graficos.html"><a href="comunicar-con-graficos.html#ejercicios-64"><i class="fa fa-check"></i><b>23.3.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="23.4" data-path="comunicar-con-graficos.html"><a href="comunicar-con-graficos.html#escalas"><i class="fa fa-check"></i><b>23.4</b> Escalas</a><ul>
<li class="chapter" data-level="23.4.1" data-path="comunicar-con-graficos.html"><a href="comunicar-con-graficos.html#ejercicios-65"><i class="fa fa-check"></i><b>23.4.1</b> Ejercicios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="24" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html"><i class="fa fa-check"></i><b>24</b> R Markdown formats</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R para Ciencia de Datos: Soluciones de los ejercicios</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modelos-conceptos-basicos" class="section level1">
<h1><span class="header-section-number">19</span> Modelos: conceptos básicos</h1>
<div id="paquetes-necesarios-2" class="section level2">
<h2><span class="header-section-number">19.1</span> Paquetes necesarios</h2>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw">library</span>(tibble)</a>
<a class="sourceLine" id="cb65-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb65-3" data-line-number="3"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb65-4" data-line-number="4"><span class="kw">library</span>(modelr)</a>
<a class="sourceLine" id="cb65-5" data-line-number="5"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb65-6" data-line-number="6"><span class="kw">library</span>(dplyr)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="kw">library</span>(stringr)</a></code></pre></div>
</div>
<div id="un-modelo-simple" class="section level2">
<h2><span class="header-section-number">19.2</span> Un modelo simple</h2>
<div id="ejercicios-54" class="section level3">
<h3><span class="header-section-number">19.2.1</span> Ejercicios</h3>
<ol style="list-style-type: decimal">
<li>Una desventaja del modelo lineal es ser sensible a valores inusuales
debido a que la distancia incorpora un término al cuadrado. Ajusta un
modelo a los datos simulados que se presentan a continuación y visualiza
los resultados. Corre el modelo varias veces para generar diferentes conjuntos
de datos simulados. ¿Qué puedes observar respecto del modelo?</li>
</ol>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1">sim1a &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb70-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb70-3" data-line-number="3">  <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rt</span>(<span class="kw">length</span>(x), <span class="dt">df =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb70-4" data-line-number="4">)</a></code></pre></div>
<div class="solucion">
<h3>
Solución
</h3>
<p>Se puede correr una vez y graficar los resultados.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="kw">ggplot</span>(sim1a, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb71-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb71-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Para sistematizarlo, se pueden generar varias simulaciones y luego graficar
las líneas.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1">simt &lt;-<span class="st"> </span><span class="cf">function</span>(i) {</a>
<a class="sourceLine" id="cb72-2" data-line-number="2">  <span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb72-3" data-line-number="3">    <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb72-4" data-line-number="4">    <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rt</span>(<span class="kw">length</span>(x), <span class="dt">df =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb72-5" data-line-number="5">    <span class="dt">.id =</span> i</a>
<a class="sourceLine" id="cb72-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb72-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb72-8" data-line-number="8"></a>
<a class="sourceLine" id="cb72-9" data-line-number="9">sims &lt;-<span class="st"> </span><span class="kw">map_df</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, simt)</a>
<a class="sourceLine" id="cb72-10" data-line-number="10"></a>
<a class="sourceLine" id="cb72-11" data-line-number="11"><span class="kw">ggplot</span>(sims, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb72-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb72-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb72-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>.id, <span class="dt">ncol =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>El ejercicio usa la función <code>rt()</code> la cual entrega
un muestreo a partir de una distribución t-Student, la cual tiene colas más
largas que la distribución normal (<code>rnorm()</code>), por lo tanto asigna una mayor
probabilidad a los valores fuera del centro de la distribución.</p>
<p>¿Qué ocurre si usamos una distribución normal?</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1">sim_norm &lt;-<span class="st"> </span><span class="cf">function</span>(i) {</a>
<a class="sourceLine" id="cb73-2" data-line-number="2">  <span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb73-3" data-line-number="3">    <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb73-4" data-line-number="4">    <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(x)),</a>
<a class="sourceLine" id="cb73-5" data-line-number="5">    <span class="dt">.id =</span> i</a>
<a class="sourceLine" id="cb73-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb73-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb73-8" data-line-number="8"></a>
<a class="sourceLine" id="cb73-9" data-line-number="9">simdf_norm &lt;-<span class="st"> </span><span class="kw">map_df</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, sim_norm)</a>
<a class="sourceLine" id="cb73-10" data-line-number="10"></a>
<a class="sourceLine" id="cb73-11" data-line-number="11"><span class="kw">ggplot</span>(simdf_norm, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb73-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb73-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb73-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>.id, <span class="dt">ncol =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Al usar distribución normal no hay tantos valores extremos y las pendientes
son más similares.</p>
<p>Para el caso de la distribución normal con media cero y desviación estándar uno,
la probabilidad de que un valor sea mayor a dos se obtiene con <code>pnorm()</code>.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="kw">pnorm</span>(<span class="dv">2</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] 0.02275013</code></pre>
<p>Para el caso de la distribución t-Student con dos grados de libertad, la
probabilidad es más del triple del caso anterior y se obtiene con <code>pt()</code>.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="kw">pt</span>(<span class="dv">2</span>, <span class="dt">df =</span> <span class="dv">2</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] 0.09175171</code></pre>
<p>Podemos concluir que el modelo es sensible a valores extremos y en general a
la distribución que siguen los datos.</p>
</div>
<ol style="list-style-type: decimal">
<li>Una forma de obtener un modelo lineal más robusto es usar una métrica
distinta para la distancia. Por ejemplo, en lugar de la raíz de la distancia
media cuadrática (del inglés <em>root-mean-squared distance</em>) se podría usar la
media de la distancia absoluta:</li>
</ol>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1">medir_distancia &lt;-<span class="st"> </span><span class="cf">function</span>(modelo, datos) {</a>
<a class="sourceLine" id="cb78-2" data-line-number="2">  diferencia &lt;-<span class="st"> </span>datos<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">modelo1</span>(modelo, datos)</a>
<a class="sourceLine" id="cb78-3" data-line-number="3">  <span class="kw">mean</span>(<span class="kw">abs</span>(diferencia))</a>
<a class="sourceLine" id="cb78-4" data-line-number="4">}</a></code></pre></div>
<p>Usa <code>optim()</code> para ajustar este modelo a los datos simulados anteriormente y
compara el resultado con el modelo lineal.</p>
<div class="solucion">
<h3>
Solución
</h3>
<p>Usando los datos <code>sim1a</code> y <code>optim()</code> podemos encontrar los parámetros que
minimizan la desviación absoluta. Definiremos la función <code>modelo1()</code> tal como
se hizo en el libro.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1">modelo1 &lt;-<span class="st"> </span><span class="cf">function</span>(a, datos) {</a>
<a class="sourceLine" id="cb79-2" data-line-number="2">  a[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>datos<span class="op">$</span>x <span class="op">*</span><span class="st"> </span>a[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb79-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb79-4" data-line-number="4"></a>
<a class="sourceLine" id="cb79-5" data-line-number="5">beta &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), medir_distancia, <span class="dt">datos =</span> sim1a)</a>
<a class="sourceLine" id="cb79-6" data-line-number="6">beta<span class="op">$</span>par</a></code></pre></div>
<pre><code>## [1] 5.882107 1.518106</code></pre>
<p>Los resultados del modelo lineal son los mismos que se obtienen si se minimiza
la desviación al cuadrado.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1">medir_distancia_ml &lt;-<span class="st"> </span><span class="cf">function</span>(modelo, datos) {</a>
<a class="sourceLine" id="cb81-2" data-line-number="2">  diferencia &lt;-<span class="st"> </span>datos<span class="op">$</span>y <span class="op">-</span><span class="st"> </span>(modelo[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>modelo[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>datos<span class="op">$</span>x)</a>
<a class="sourceLine" id="cb81-3" data-line-number="3">  <span class="kw">sqrt</span>(<span class="kw">mean</span>(diferencia<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb81-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb81-5" data-line-number="5"></a>
<a class="sourceLine" id="cb81-6" data-line-number="6">beta &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), medir_distancia_ml, <span class="dt">datos =</span> sim1a)</a>
<a class="sourceLine" id="cb81-7" data-line-number="7">beta<span class="op">$</span>par</a></code></pre></div>
<pre><code>## [1] 6.178097 1.474863</code></pre>
<p>En la práctica no es recomendable usar <code>optim()</code> para ajustar un modelo, es
mejor utilizar implementaciones ya existentes como <code>rlm()</code> y <code>lqs()</code> que son
parte del paquete <a href="https://CRAN.R-project.org/package=MASS">MASS</a>.</p>
<p>La justificación es que estas implementaciones permiten ajustar modelos
robustos sin los múltiples problemas de carácter numérico que pueden surgir de
manera condicional a los datos al momento de usar <code>optim()</code>.</p>
</div>
<ol style="list-style-type: decimal">
<li>Un desafío al realizar optimización numérica es que únicamente garantiza
encontrar un óptimo local. ¿Qué problema se presenta al optimizar un modelo de
tres parámetros como el que se presenta a continuación?</li>
</ol>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1">modelo3 &lt;-<span class="st"> </span><span class="cf">function</span>(a, datos) {</a>
<a class="sourceLine" id="cb83-2" data-line-number="2">  a[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>datos<span class="op">$</span>x <span class="op">*</span><span class="st"> </span>a[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>a[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb83-3" data-line-number="3">}</a></code></pre></div>
<div class="solucion">
<h3>
Solución
</h3>
<p>El problema es que dados los valores <code>a[1] = a1</code> y <code>a[3] = a3</code>, cualquier otra
combinación de <code>a[1]</code> y <code>a[3]</code> tal que <code>a[1] + a[3] == (a1 + a3)</code> tendrá el
mismo ajuste.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1">medir_distancia_<span class="dv">3</span>_ml &lt;-<span class="st"> </span><span class="cf">function</span>(a, datos) {</a>
<a class="sourceLine" id="cb84-2" data-line-number="2">  diferencia &lt;-<span class="st"> </span>datos<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">modelo3</span>(a, datos)</a>
<a class="sourceLine" id="cb84-3" data-line-number="3">  <span class="kw">sqrt</span>(<span class="kw">mean</span>(diferencia<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb84-4" data-line-number="4">}</a></code></pre></div>
<p>Dependiendo de los valores inciales se van a obtener distintos valores óptimos.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1">beta_<span class="dv">000</span> &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), medir_distancia_<span class="dv">3</span>_ml, <span class="dt">datos =</span> sim1a)</a>
<a class="sourceLine" id="cb85-2" data-line-number="2">beta_<span class="dv">000</span><span class="op">$</span>par</a></code></pre></div>
<pre><code>## [1] -3.759406  1.474911  9.937369</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1">beta_<span class="dv">001</span> &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), medir_distancia_<span class="dv">3</span>_ml, <span class="dt">datos =</span> sim1a)</a>
<a class="sourceLine" id="cb87-2" data-line-number="2">beta_<span class="dv">001</span><span class="op">$</span>par</a></code></pre></div>
<pre><code>## [1] -8.861492  1.474764 15.040083</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1">beta_<span class="dv">005</span> &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">5</span>), medir_distancia_<span class="dv">3</span>_ml, <span class="dt">datos =</span> sim1a)</a>
<a class="sourceLine" id="cb89-2" data-line-number="2">beta_<span class="dv">005</span><span class="op">$</span>par</a></code></pre></div>
<pre><code>## [1] 1.106959 1.475012 5.070307</code></pre>
<p>Si seguimos alterando los valores inciales no es muy difícil concluir que
existen infinitos valores óptimos para este modelo.</p>
</div>
</div>
</div>
<div id="visualizando-modelos" class="section level2">
<h2><span class="header-section-number">19.3</span> Visualizando modelos</h2>
<div id="ejercicios-55" class="section level3">
<h3><span class="header-section-number">19.3.1</span> Ejercicios</h3>
<ol style="list-style-type: decimal">
<li>En lugar de usar <code>lm()</code> para ajustar una línea recta, puedes usar <code>loess()</code>
para ajustar una curva suave. Repite el proceso de ajustar el modelo,
generar la cuadrícula, predicciones y visualización con <code>sim1</code> usando <code>loess()</code>
en vez de <code>lm()</code>. ¿Cómo se compara el resultado a <code>geom_smooth()</code>.</li>
</ol>
<div class="solucion">
<h3>
Solución
</h3>
<p>Usando <code>add_predictions()</code> y <code>add_residuals()</code> se pueden agregar las
predicciones y los residuos de la regresión loess a los datos <code>sim1a</code>.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1">sim1_loess &lt;-<span class="st"> </span><span class="kw">loess</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1a)</a>
<a class="sourceLine" id="cb91-2" data-line-number="2">sim1_lm &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1a)</a>
<a class="sourceLine" id="cb91-3" data-line-number="3"></a>
<a class="sourceLine" id="cb91-4" data-line-number="4">grid_loess &lt;-<span class="st"> </span>sim1a <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb91-5" data-line-number="5"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_loess)</a>
<a class="sourceLine" id="cb91-6" data-line-number="6"></a>
<a class="sourceLine" id="cb91-7" data-line-number="7">sim1a &lt;-<span class="st"> </span>sim1a <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb91-8" data-line-number="8"><span class="st">  </span><span class="kw">add_residuals</span>(sim1_lm) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb91-9" data-line-number="9"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_lm) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb91-10" data-line-number="10"><span class="st">  </span><span class="kw">add_residuals</span>(sim1_loess, <span class="dt">var =</span> <span class="st">&quot;resid_loess&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb91-11" data-line-number="11"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_loess, <span class="dt">var =</span> <span class="st">&quot;pred_loess&quot;</span>)</a></code></pre></div>
<p>Ahora procedemos a graficar las predicciones. La regresión loess genera un
ajuste no lineal a partir de los datos.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1">plot_sim1_loess &lt;-<span class="st"> </span><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb92-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb92-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> pred), <span class="dt">data =</span> grid_loess, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb92-4" data-line-number="4"></a>
<a class="sourceLine" id="cb92-5" data-line-number="5">plot_sim1_loess</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Las predicciones del modelo loess son las mismas que entrega el método por
defecto de <code>geom_smooth()</code> ya que este usa <code>loess()</code> y entrega un mensaje al
respecto.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1">plot_sim1_loess <span class="op">+</span></a>
<a class="sourceLine" id="cb93-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">alpha =</span> <span class="fl">0.20</span>)</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Podemos graficar los residuos de loess (en rojo) y compararlos con los del
modelo lineal (en negro). En general, el modelo loess tiene un menor residuo
dada la muestra (fuera de la muestra no se asegura este comportamiento y no
hemos considerado la incertidumbre de la estimación).</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="kw">ggplot</span>(sim1a, <span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span></a>
<a class="sourceLine" id="cb94-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_ref_line</span>(<span class="dt">h =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb94-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> resid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb94-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> resid_loess), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<ol style="list-style-type: decimal">
<li><code>add_predictions()</code> está pareada con <code>gather_predictions()</code> y
<code>spread_predictions()</code>. ¿Cómo difieren estas tres funciones?</li>
</ol>
<div class="solucion">
<h3>
Solución
</h3>
<p>Las funciones <code>gather_predictions()</code> y <code>spread_predictions()</code> permiten incluir
simultáneamente las predicciones de múltiples modelos.</p>
<p>Por ejemplo, se puede incluir <code>sim1_mod</code>.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1">sim1_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb95-2" data-line-number="2"></a>
<a class="sourceLine" id="cb95-3" data-line-number="3">grid &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb95-4" data-line-number="4"><span class="st">  </span><span class="kw">data_grid</span>(x)</a></code></pre></div>
<p>La función <code>add_predictions()</code> permite incluir un modelo a la vez. Para agregar
dos modelos se debe encadenar con el operador <code>%&gt;%</code>.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1">grid <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb96-2" data-line-number="2"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_mod, <span class="dt">var =</span> <span class="st">&quot;pred_lm&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb96-3" data-line-number="3"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_loess, <span class="dt">var =</span> <span class="st">&quot;pred_loess&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##        x pred_lm pred_loess
##    &lt;int&gt;   &lt;dbl&gt;      &lt;dbl&gt;
##  1     1    6.27       8.80
##  2     2    8.32       9.66
##  3     3   10.4       10.5 
##  4     4   12.4       11.4 
##  5     5   14.5       12.3 
##  6     6   16.5       13.8 
##  7     7   18.6       16.0 
##  8     8   20.6       18.1 
##  9     9   22.7       20.0 
## 10    10   24.7       21.8</code></pre>
<p>La función <code>gather_predictions()</code> incorpora predicciones de múltiples modelos
por medio de agrupar los resultados e incluir una columna con el nombre del
modelo.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1">grid <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb98-2" data-line-number="2"><span class="st">  </span><span class="kw">gather_predictions</span>(sim1_mod, sim1_loess)</a></code></pre></div>
<pre><code>## # A tibble: 20 x 3
##    model          x  pred
##    &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt;
##  1 sim1_mod       1  6.27
##  2 sim1_mod       2  8.32
##  3 sim1_mod       3 10.4 
##  4 sim1_mod       4 12.4 
##  5 sim1_mod       5 14.5 
##  6 sim1_mod       6 16.5 
##  7 sim1_mod       7 18.6 
##  8 sim1_mod       8 20.6 
##  9 sim1_mod       9 22.7 
## 10 sim1_mod      10 24.7 
## 11 sim1_loess     1  8.80
## 12 sim1_loess     2  9.66
## 13 sim1_loess     3 10.5 
## 14 sim1_loess     4 11.4 
## 15 sim1_loess     5 12.3 
## 16 sim1_loess     6 13.8 
## 17 sim1_loess     7 16.0 
## 18 sim1_loess     8 18.1 
## 19 sim1_loess     9 20.0 
## 20 sim1_loess    10 21.8</code></pre>
<p>La función <code>spread_predictions()</code> incorpora predicciones de múltiples modelos
agregando múltiples columnas (de acuerdo al nombre de cada modelo) que contienen
las predicciones respectivas.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1">grid <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb100-2" data-line-number="2"><span class="st">  </span><span class="kw">spread_predictions</span>(sim1_mod, sim1_loess)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##        x sim1_mod sim1_loess
##    &lt;int&gt;    &lt;dbl&gt;      &lt;dbl&gt;
##  1     1     6.27       8.80
##  2     2     8.32       9.66
##  3     3    10.4       10.5 
##  4     4    12.4       11.4 
##  5     5    14.5       12.3 
##  6     6    16.5       13.8 
##  7     7    18.6       16.0 
##  8     8    20.6       18.1 
##  9     9    22.7       20.0 
## 10    10    24.7       21.8</code></pre>
<p>La función <code>spread_predictions()</code> es similar a correr <code>add_predictions()</code> para
cada modelo que se quiere incorporar y es equivalente a correr <code>spread()</code> luego
de <code>gather_predictions()</code>.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1">grid <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb102-2" data-line-number="2"><span class="st">  </span><span class="kw">gather_predictions</span>(sim1_mod, sim1_loess) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb102-3" data-line-number="3"><span class="st">  </span><span class="kw">spread</span>(model, pred)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##        x sim1_loess sim1_mod
##    &lt;int&gt;      &lt;dbl&gt;    &lt;dbl&gt;
##  1     1       8.80     6.27
##  2     2       9.66     8.32
##  3     3      10.5     10.4 
##  4     4      11.4     12.4 
##  5     5      12.3     14.5 
##  6     6      13.8     16.5 
##  7     7      16.0     18.6 
##  8     8      18.1     20.6 
##  9     9      20.0     22.7 
## 10    10      21.8     24.7</code></pre>
</div>
<ol style="list-style-type: decimal">
<li>¿Qué hace <code>geom_ref_line()</code>? ¿De qué paquete proviene? ¿Por qué es útil e importante
incluir una línea de referencia en los gráficos que muestran residuos?</li>
</ol>
<div class="solucion">
<h3>
Solución
</h3>
<p>La geometría <code>geom_ref_line()</code> agrega una línea de referencia al gráfico. Es el
equivalente a usar <code>geom_hline()</code> o <code>geom_vline()</code> con las opciones por defecto
y que nos sirven para visualizar modelos.</p>
<p>Agregar una línea de referencia en torno a cero para los residuos es importante
ya que un buen modelo, por lo general, tiene residuos centrados en torno a cero.
Otras características relevantes son que los errores deben tener idéntica
varianza y no estar correlacionados entre si.</p>
<p>La línea de referencia en torno a cero permite evaluar visualmente estas
características.</p>
</div>
<ol style="list-style-type: decimal">
<li>¿Por qué quisieras mirar un polígono de frecuencias con los residuos absolutos? ¿Cuáles son las
ventajas y desventajas de los residuos crudos?</li>
</ol>
<div class="solucion">
<h3>
Solución
</h3>
<p>Mostrar los valores absolutos de los residuos facilita ver la magnitud del
error. El modelo lineal asume que los residuos tienen media cero y usar los
valores absolutos de los residuos permite ver lo que ocurre cuando los errores
de signos opuestos no se cancelan mutuamente.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1">sim1_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1a)</a>
<a class="sourceLine" id="cb104-2" data-line-number="2"></a>
<a class="sourceLine" id="cb104-3" data-line-number="3">sim1 &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb104-4" data-line-number="4"><span class="st">  </span><span class="kw">add_residuals</span>(sim1_mod)</a>
<a class="sourceLine" id="cb104-5" data-line-number="5"></a>
<a class="sourceLine" id="cb104-6" data-line-number="6"><span class="kw">ggplot</span>(sim1a, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">abs</span>(resid))) <span class="op">+</span></a>
<a class="sourceLine" id="cb104-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>El inconveniente que aparece visualmente es que se pierde toda información
respecto de los signos de los residuos. Por lo tanto, el polígono de frecuencias
no distingue si acaso el modelo sobre-estima o sub-estima de manera consistente.</p>
</div>
</div>
</div>
<div id="formulas-y-familias-de-modelos" class="section level2">
<h2><span class="header-section-number">19.4</span> Fórmulas y familias de modelos</h2>
<div id="ejercicios-56" class="section level3">
<h3><span class="header-section-number">19.4.1</span> Ejercicios</h3>
<ol style="list-style-type: decimal">
<li>¿Qué pasa si repites el análisis de <code>sim2</code> usando un modelo sin intercepto? ¿Qué ocurre con la
ecuación del modelo? ¿Qué ocurre con las predicciones?</li>
</ol>
<div class="solucion">
<h3>
Solución
</h3>
<p>Para estimar el modelo sin intercepto agregamos <code>-1</code> o <code>+0</code> al lado derecho
de la fórmula.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1">mod2a &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> sim2)</a>
<a class="sourceLine" id="cb105-2" data-line-number="2"></a>
<a class="sourceLine" id="cb105-3" data-line-number="3">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim2)</a></code></pre></div>
<p>Las predicciones son las mismas en el caso con o sin intercepto:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1">grid &lt;-<span class="st"> </span>sim2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-2" data-line-number="2"><span class="st">  </span><span class="kw">data_grid</span>(x) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-3" data-line-number="3"><span class="st">  </span><span class="kw">spread_predictions</span>(mod2, mod2a)</a>
<a class="sourceLine" id="cb106-4" data-line-number="4"></a>
<a class="sourceLine" id="cb106-5" data-line-number="5">grid</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   x      mod2 mod2a
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 a      1.15  1.15
## 2 b      8.12  8.12
## 3 c      6.13  6.13
## 4 d      1.91  1.91</code></pre>
</div>
<ol style="list-style-type: decimal">
<li>Usa <code>model_matrix()</code> para explorar las ecuaciones generadas por los modelos ajustados a <code>sim3</code> y
<code>sim4</code>. ¿Por qué <code>*</code> es un atajo para la interacción?</li>
</ol>
<div class="solucion">
<h3>
Solución
</h3>
<p>El caso <code>x1 * x2</code> cuando <code>x2</code> es una variable categórica produce las variables
binarias <code>x2b</code>, <code>x2c</code> y <code>x2d</code> y las variables continuas <code>x1:x2b</code>, <code>x1:x2c</code> y
<code>x1:x2d</code> que son el producto de <code>x1</code> y <code>x2*</code>.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1">x3 &lt;-<span class="st"> </span><span class="kw">model_matrix</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)</a>
<a class="sourceLine" id="cb108-2" data-line-number="2">x3</a></code></pre></div>
<pre><code>## # A tibble: 120 x 8
##    `(Intercept)`    x1   x2b   x2c   x2d `x1:x2b` `x1:x2c` `x1:x2d`
##            &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1             1     1     0     0     0        0        0        0
##  2             1     1     0     0     0        0        0        0
##  3             1     1     0     0     0        0        0        0
##  4             1     1     1     0     0        1        0        0
##  5             1     1     1     0     0        1        0        0
##  6             1     1     1     0     0        1        0        0
##  7             1     1     0     1     0        0        1        0
##  8             1     1     0     1     0        0        1        0
##  9             1     1     0     1     0        0        1        0
## 10             1     1     0     0     1        0        0        1
## # … with 110 more rows</code></pre>
<p>Podemos confirmar que las variables <code>x1:x2b</code> son el producto de <code>x1</code> y <code>x2b</code>.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw">all</span>(x3[[<span class="st">&quot;x1:x2b&quot;</span>]] <span class="op">==</span><span class="st"> </span>(x3[[<span class="st">&quot;x1&quot;</span>]] <span class="op">*</span><span class="st"> </span>x3[[<span class="st">&quot;x2b&quot;</span>]]))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Es similar para <code>x1:x2c</code> y <code>x2c</code> como para el caso de <code>x1:x2d</code> y <code>x2d</code>.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw">all</span>(x3[[<span class="st">&quot;x1:x2c&quot;</span>]] <span class="op">==</span><span class="st"> </span>(x3[[<span class="st">&quot;x1&quot;</span>]] <span class="op">*</span><span class="st"> </span>x3[[<span class="st">&quot;x2c&quot;</span>]]))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1"><span class="kw">all</span>(x3[[<span class="st">&quot;x1:x2d&quot;</span>]] <span class="op">==</span><span class="st"> </span>(x3[[<span class="st">&quot;x1&quot;</span>]] <span class="op">*</span><span class="st"> </span>x3[[<span class="st">&quot;x2d&quot;</span>]]))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Para <code>x1 * x2</code> cuando <code>x1</code> y <code>x2</code> son continuas, <code>model_matrix()</code> creas las
variables <code>x1</code>, <code>x2</code> y <code>x1:x2</code>.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1">x4 &lt;-<span class="st"> </span><span class="kw">model_matrix</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim4)</a>
<a class="sourceLine" id="cb116-2" data-line-number="2">x4</a></code></pre></div>
<pre><code>## # A tibble: 300 x 4
##    `(Intercept)`    x1     x2 `x1:x2`
##            &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1             1    -1 -1       1    
##  2             1    -1 -1       1    
##  3             1    -1 -1       1    
##  4             1    -1 -0.778   0.778
##  5             1    -1 -0.778   0.778
##  6             1    -1 -0.778   0.778
##  7             1    -1 -0.556   0.556
##  8             1    -1 -0.556   0.556
##  9             1    -1 -0.556   0.556
## 10             1    -1 -0.333   0.333
## # … with 290 more rows</code></pre>
<p>Se puede confirmar que <code>x1:x2</code> es el producto de <code>x1</code> y <code>x2</code>.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1"><span class="kw">all</span>(x4[[<span class="st">&quot;x1&quot;</span>]] <span class="op">*</span><span class="st"> </span>x4[[<span class="st">&quot;x2&quot;</span>]] <span class="op">==</span><span class="st"> </span>x4[[<span class="st">&quot;x1:x2&quot;</span>]])</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<ol style="list-style-type: decimal">
<li>Usando los principios básicos, convierte las fórmulas de los siguientes modelos en funciones.
(Sugerencia: comienza por convertir las variables categóricas en ceros y unos.)</li>
</ol>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)</a>
<a class="sourceLine" id="cb120-2" data-line-number="2">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)</a></code></pre></div>
<div class="solucion">
<h3>
Solución
</h3>
<p>El lado derecho de las fórmulas se encarga de generar una matriz de diseño a
partir de las columnas <code>x1</code> y <code>x2</code>, lo que se ve reflejado en <code>model_matrix()</code>.</p>
<p>Veamos los niveles de <code>x2</code>, que por ser una variable categórica es la más
compleja de llevar a la matriz de diseño. <code>x1</code> permanece inalterada.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="kw">levels</span>(sim3<span class="op">$</span>x2)</a></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot;</code></pre>
<p>Para el caso <code>~ x1 + x2</code> lo que haremos es considerar “a” como el nivel de
referencia, por lo que se omite, y luego generamos nuevas columnas para los
niveles “b”, “c” y “d”.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1">model_matrix_mod1 &lt;-<span class="st"> </span><span class="cf">function</span>(.data) {</a>
<a class="sourceLine" id="cb123-2" data-line-number="2">  <span class="kw">mutate</span>(.data,</a>
<a class="sourceLine" id="cb123-3" data-line-number="3">    <span class="dt">x2b =</span> <span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;b&quot;</span>),</a>
<a class="sourceLine" id="cb123-4" data-line-number="4">    <span class="dt">x2c =</span> <span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;c&quot;</span>),</a>
<a class="sourceLine" id="cb123-5" data-line-number="5">    <span class="dt">x2d =</span> <span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;d&quot;</span>),</a>
<a class="sourceLine" id="cb123-6" data-line-number="6">    <span class="st">`</span><span class="dt">(Intercept)</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb123-7" data-line-number="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-8" data-line-number="8"><span class="st">    </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">(Intercept)</span><span class="st">`</span>, x1, x2b, x2c, x2d)</a>
<a class="sourceLine" id="cb123-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb123-10" data-line-number="10"></a>
<a class="sourceLine" id="cb123-11" data-line-number="11"><span class="kw">model_matrix_mod1</span>(sim3)</a></code></pre></div>
<pre><code>## # A tibble: 120 x 5
##    `(Intercept)`    x1   x2b   x2c   x2d
##            &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1             1     1     0     0     0
##  2             1     1     0     0     0
##  3             1     1     0     0     0
##  4             1     1     1     0     0
##  5             1     1     1     0     0
##  6             1     1     1     0     0
##  7             1     1     0     1     0
##  8             1     1     0     1     0
##  9             1     1     0     1     0
## 10             1     1     0     0     1
## # … with 110 more rows</code></pre>
<p>Es posible crear función para <code>~ x1 + x2</code> que no depende de los niveles
específicos de <code>x2</code>.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">model_matrix_mod1b &lt;-<span class="st"> </span><span class="cf">function</span>(.data) {</a>
<a class="sourceLine" id="cb125-2" data-line-number="2">  <span class="co"># niveles de x2</span></a>
<a class="sourceLine" id="cb125-3" data-line-number="3">  lvls &lt;-<span class="st"> </span><span class="kw">levels</span>(.data<span class="op">$</span>x2)</a>
<a class="sourceLine" id="cb125-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb125-5" data-line-number="5">  <span class="co"># borramos el primer nivel (es de referencia)</span></a>
<a class="sourceLine" id="cb125-6" data-line-number="6">  <span class="co"># asumimos que hay al menos dos niveles</span></a>
<a class="sourceLine" id="cb125-7" data-line-number="7">  lvls &lt;-<span class="st"> </span>lvls[<span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(lvls)]</a>
<a class="sourceLine" id="cb125-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb125-9" data-line-number="9">  <span class="co"># creamos una variable binaria para cada nivel de x2</span></a>
<a class="sourceLine" id="cb125-10" data-line-number="10">  <span class="cf">for</span> (lvl <span class="cf">in</span> lvls) {</a>
<a class="sourceLine" id="cb125-11" data-line-number="11">    varname &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;x2&quot;</span>, lvl)</a>
<a class="sourceLine" id="cb125-12" data-line-number="12">    .data[[varname]] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(.data<span class="op">$</span>x2 <span class="op">==</span><span class="st"> </span>lvl)</a>
<a class="sourceLine" id="cb125-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb125-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb125-15" data-line-number="15">  <span class="co"># generamos una lista de las variables que se mantienen</span></a>
<a class="sourceLine" id="cb125-16" data-line-number="16">  x2_variables &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;x2&quot;</span>, lvls)</a>
<a class="sourceLine" id="cb125-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb125-18" data-line-number="18">  <span class="co"># agregamos el intercepto</span></a>
<a class="sourceLine" id="cb125-19" data-line-number="19">  .data[[<span class="st">&quot;(Intercept)&quot;</span>]] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb125-20" data-line-number="20">  </a>
<a class="sourceLine" id="cb125-21" data-line-number="21">  <span class="co"># mantenemos las variables binarias x1 y x2</span></a>
<a class="sourceLine" id="cb125-22" data-line-number="22">  <span class="kw">select</span>(.data, <span class="st">`</span><span class="dt">(Intercept)</span><span class="st">`</span>, x1, <span class="kw">one_of</span>(x2_variables))</a>
<a class="sourceLine" id="cb125-23" data-line-number="23">}</a>
<a class="sourceLine" id="cb125-24" data-line-number="24"></a>
<a class="sourceLine" id="cb125-25" data-line-number="25"><span class="kw">model_matrix_mod1b</span>(sim3)</a></code></pre></div>
<pre><code>## # A tibble: 120 x 5
##    `(Intercept)`    x1   x2b   x2c   x2d
##            &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1             1     1     0     0     0
##  2             1     1     0     0     0
##  3             1     1     0     0     0
##  4             1     1     1     0     0
##  5             1     1     1     0     0
##  6             1     1     1     0     0
##  7             1     1     0     1     0
##  8             1     1     0     1     0
##  9             1     1     0     1     0
## 10             1     1     0     0     1
## # … with 110 more rows</code></pre>
<p>Para el caso <code>~ x1 * x2</code> hay que tener en cuenta que debemos generar una columna
por cada nivel de <code>x2</code>, sin contar el nivel de referencia que interactúa con
<code>x1</code>.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">model_matrix_mod2 &lt;-<span class="st"> </span><span class="cf">function</span>(.data) {</a>
<a class="sourceLine" id="cb127-2" data-line-number="2">  <span class="kw">mutate</span>(.data,</a>
<a class="sourceLine" id="cb127-3" data-line-number="3">    <span class="st">`</span><span class="dt">(Intercept)</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb127-4" data-line-number="4">    <span class="dt">x2b =</span> <span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;b&quot;</span>),</a>
<a class="sourceLine" id="cb127-5" data-line-number="5">    <span class="dt">x2c =</span> <span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;c&quot;</span>),</a>
<a class="sourceLine" id="cb127-6" data-line-number="6">    <span class="dt">x2d =</span> <span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;d&quot;</span>),</a>
<a class="sourceLine" id="cb127-7" data-line-number="7">    <span class="st">`</span><span class="dt">x1:x2b</span><span class="st">`</span> =<span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2b,</a>
<a class="sourceLine" id="cb127-8" data-line-number="8">    <span class="st">`</span><span class="dt">x1:x2c</span><span class="st">`</span> =<span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2c,</a>
<a class="sourceLine" id="cb127-9" data-line-number="9">    <span class="st">`</span><span class="dt">x1:x2d</span><span class="st">`</span> =<span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2d</a>
<a class="sourceLine" id="cb127-10" data-line-number="10">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-11" data-line-number="11"><span class="st">    </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">(Intercept)</span><span class="st">`</span>, x1, x2b, x2c, x2d, <span class="st">`</span><span class="dt">x1:x2b</span><span class="st">`</span>, <span class="st">`</span><span class="dt">x1:x2c</span><span class="st">`</span>, <span class="st">`</span><span class="dt">x1:x2d</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb127-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb127-13" data-line-number="13"></a>
<a class="sourceLine" id="cb127-14" data-line-number="14"><span class="kw">model_matrix_mod2</span>(sim3)</a></code></pre></div>
<pre><code>## # A tibble: 120 x 8
##    `(Intercept)`    x1   x2b   x2c   x2d `x1:x2b` `x1:x2c` `x1:x2d`
##            &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1             1     1     0     0     0        0        0        0
##  2             1     1     0     0     0        0        0        0
##  3             1     1     0     0     0        0        0        0
##  4             1     1     1     0     0        1        0        0
##  5             1     1     1     0     0        1        0        0
##  6             1     1     1     0     0        1        0        0
##  7             1     1     0     1     0        0        1        0
##  8             1     1     0     1     0        0        1        0
##  9             1     1     0     1     0        0        1        0
## 10             1     1     0     0     1        0        0        1
## # … with 110 more rows</code></pre>
<p>Es posible crear una función para <code>~ x1 * x2</code> que no depende de los niveles
específicos de <code>x2</code>.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">model_matrix_mod2b &lt;-<span class="st"> </span><span class="cf">function</span>(.data) {</a>
<a class="sourceLine" id="cb129-2" data-line-number="2">  <span class="co"># partimos de la base del modelo x1 + x2</span></a>
<a class="sourceLine" id="cb129-3" data-line-number="3">  out &lt;-<span class="st"> </span><span class="kw">model_matrix_mod1b</span>(.data)</a>
<a class="sourceLine" id="cb129-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb129-5" data-line-number="5">  <span class="co"># tomamos las columnas que contienen &quot;x2&quot;</span></a>
<a class="sourceLine" id="cb129-6" data-line-number="6">  x2cols &lt;-<span class="st"> </span><span class="kw">str_subset</span>(<span class="kw">colnames</span>(out), <span class="st">&quot;^x2&quot;</span>)</a>
<a class="sourceLine" id="cb129-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb129-8" data-line-number="8">  <span class="co"># creamos las variables de interacción</span></a>
<a class="sourceLine" id="cb129-9" data-line-number="9">  <span class="cf">for</span> (varname <span class="cf">in</span> x2cols) {</a>
<a class="sourceLine" id="cb129-10" data-line-number="10">    newvar &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;x1:&quot;</span>, varname)</a>
<a class="sourceLine" id="cb129-11" data-line-number="11">    out[[newvar]] &lt;-<span class="st"> </span>out<span class="op">$</span>x1 <span class="op">*</span><span class="st"> </span>out[[varname]]</a>
<a class="sourceLine" id="cb129-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb129-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb129-14" data-line-number="14">  out</a>
<a class="sourceLine" id="cb129-15" data-line-number="15">}</a>
<a class="sourceLine" id="cb129-16" data-line-number="16"></a>
<a class="sourceLine" id="cb129-17" data-line-number="17"><span class="kw">model_matrix_mod2b</span>(sim3)</a></code></pre></div>
<pre><code>## # A tibble: 120 x 8
##    `(Intercept)`    x1   x2b   x2c   x2d `x1:x2b` `x1:x2c` `x1:x2d`
##            &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1             1     1     0     0     0        0        0        0
##  2             1     1     0     0     0        0        0        0
##  3             1     1     0     0     0        0        0        0
##  4             1     1     1     0     0        1        0        0
##  5             1     1     1     0     0        1        0        0
##  6             1     1     1     0     0        1        0        0
##  7             1     1     0     1     0        0        1        0
##  8             1     1     0     1     0        0        1        0
##  9             1     1     0     1     0        0        1        0
## 10             1     1     0     0     1        0        0        1
## # … with 110 more rows</code></pre>
<p>Estas funciones se podrían generalizar para los casos en que <code>x1</code> y <code>x2</code> pueden
ser de tipo numérico o categórico. Si seguimos generalizando acabaremos
reescribiendo la función <code>matrix_model()</code>.</p>
</div>
<ol style="list-style-type: decimal">
<li>Para <code>sim4</code>, ¿Es mejor <code>mod1</code> o <code>mod2</code>? Yo creo que <code>mod2</code> es ligeramente mejor
removiendo las tendencias, pero es bastante sutil. ¿Puedes generar un gráfico
que de sustento a esta hipótesis?</li>
</ol>
<div class="solucion">
<h3>
Solución
</h3>
<p>Estimamos los modelos <code>mod1</code> y <code>mod2</code> a partir de <code>sim4</code>,</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> sim4)</a>
<a class="sourceLine" id="cb131-2" data-line-number="2">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim4)</a></code></pre></div>
<p>Luego agregamos los residuos a los datos de <code>sim4</code>.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1">sim4_mods &lt;-<span class="st"> </span><span class="kw">gather_residuals</span>(sim4, mod1, mod2)</a></code></pre></div>
<p>Ahora podemos generar un gráfico de frecuencias de los residuos y los valores
absolutos de estos.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1"><span class="kw">ggplot</span>(sim4_mods, <span class="kw">aes</span>(<span class="dt">x =</span> resid, <span class="dt">colour =</span> model)) <span class="op">+</span></a>
<a class="sourceLine" id="cb133-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb133-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_rug</span>()</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1"><span class="kw">ggplot</span>(sim4_mods, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">abs</span>(resid), <span class="dt">colour =</span> model)) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_rug</span>()</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-41-2.png" width="672" /></p>
<p>Esto no muestra una gran diferencia. Sin embargo, <code>mod2</code> parece tener menos
residuos en las colas de la distribución entre 2,5 y 5, aunque los residuos más
extremos son los de este modelo.</p>
<p>Podemos verificar lo anterior calculando la desviación estándar de los residuos
para cada modelo.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1">sim4_mods <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(model) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">resid =</span> <span class="kw">sd</span>(resid))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   model resid
##   &lt;chr&gt; &lt;dbl&gt;
## 1 mod1   2.10
## 2 mod2   2.07</code></pre>
<p>La desviación estándar de los residuos de <code>mod2</code> es menor que la de <code>mod1</code>.</p>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="model-intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-building.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cienciadedatos/r4ds-soluciones/edit/master/23-model-basics.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
